name: ğŸ›¡ï¸ StellarSpeak Site Guardian

on:
  schedule:
    - cron: '*/15 6-22 * * *'
    - cron: '0 * * * *'
  workflow_dispatch:
    inputs:
      test_type:
        description: 'Ù†ÙˆØ¹ Ø§Ù„ÙØ­Øµ'
        required: true
        default: 'full'
        type: choice
        options:
        - quick
        - full
        - post-migration

jobs:
  site-monitoring:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4
      
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        # cache: 'npm'  â† Ø§Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
    
    - name: ğŸ“¦ Install Dependencies
      run: |
        npm install -D @playwright/test
        npx playwright install --with-deps chromium
    
    - name: ğŸ›¡ï¸ Run Site Guardian Tests
      run: npx playwright test
      env:
        SITE_URL: https://www.stellarspeak.online
        TEST_TYPE: ${{ github.event.inputs.test_type || 'quick' }}
    
    - name: ğŸ“Š Upload Test Results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: site-guardian-report-${{ github.run_number }}
        path: |
          test-results/
          playwright-report/
        retention-days: 30
    
    - name: ğŸš¨ Send Alert if Failed
      if: failure()
      run: |
        echo "âš ï¸ Site Guardian detected issues!"
        echo "Check report: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
