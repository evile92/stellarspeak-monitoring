name: ğŸ›¡ï¸ StellarSpeak Site Guardian

on:
  schedule:
    # ÙØ­Øµ ÙƒÙ„ 12 Ø³Ø§Ø¹Ø© (Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„ ÙˆØ§Ù„Ø¸Ù‡Ø± Ø¨ØªÙˆÙ‚ÙŠØª UTC)
    - cron: '0 */12 * * *'
  
  workflow_dispatch:
    inputs:
      test_type:
        description: 'Ù†ÙˆØ¹ Ø§Ù„ÙØ­Øµ'
        required: true
        default: 'full'
        type: choice
        options:
        - quick
        - full
        - telegram-test

jobs:
  site-monitoring:
    runs-on: ubuntu-latest
    timeout-minutes: 30  # â¬…ï¸ Ø¥Ø¶Ø§ÙØ© timeout Ù„Ù„Ù€ job Ø¨Ø£ÙƒÙ…Ù„Ù‡
    container:
      image: mcr.microsoft.com/playwright:v1.49.0-jammy  # â¬…ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Docker image Ø¬Ø§Ù‡Ø²
    
    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4
      
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: ğŸ—‚ï¸ Cache Playwright Browsers  # â¬…ï¸ Ø¥Ø¶Ø§ÙØ© cache Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„ØªØ«Ø¨ÙŠØª
      uses: actions/cache@v4
      id: playwright-cache
      with:
        path: |
          ~/.cache/ms-playwright
        key: playwright-${{ runner.os }}-${{ hashFiles('**/package-lock.json') }}
        restore-keys: |
          playwright-${{ runner.os }}-
    
    - name: ğŸ“¦ Install Dependencies
      run: npm install -D @playwright/test
      timeout-minutes: 5  # â¬…ï¸ ØªÙ‚Ù„ÙŠÙ„ timeout Ù„Ø£Ù† npm Ø£Ø³Ø±Ø¹
    
    # â¬…ï¸ Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø£Ù†Ù‡ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Docker image
    
    - name: ğŸ›¡ï¸ Run Site Guardian Tests
      id: tests
      run: |
        npx playwright test --reporter=json > test-results.json 2>&1 || echo "Tests completed"
        echo "tests_completed=true" >> $GITHUB_OUTPUT
      env:
        SITE_URL: https://www.stellarspeak.online  # â¬…ï¸ Ø¥ØµÙ„Ø§Ø­ URL
        TEST_TYPE: ${{ github.event.inputs.test_type || 'full' }}
        MONITOR_EMAIL: ${{ secrets.MONITOR_EMAIL }}
        MONITOR_PASSWORD: ${{ secrets.MONITOR_PASSWORD }}
      timeout-minutes: 15
    
    - name: ğŸ“Š Parse Test Results
      id: parse_results
      run: |
        node -e "
        const fs = require('fs');
        try {
          let results = {};
          let stats = { expected: 0, passed: 0, failed: 0, skipped: 0 };
          
          if (fs.existsSync('test-results.json')) {
            const content = fs.readFileSync('test-results.json', 'utf8');
            results = JSON.parse(content);
            stats = results.stats || stats;
          }
          
          const total = stats.expected || 0;
          const passed = stats.passed || 0;
          const failed = stats.failed || 0;
          const skipped = stats.skipped || 0;
          const duration = results.duration ? (results.duration / 1000).toFixed(2) : '0';
          
          const status = failed > 0 ? 'ğŸ”´ FAILED' : 'âœ… PASSED';
          const timestamp = new Date().toLocaleString('ar-SA', {timeZone: 'Asia/Riyadh'});
          const runNumber = '${{ github.run_number }}';
          const runId = '${{ github.run_id }}';
          const repoName = '${{ github.repository }}';
          const actor = '${{ github.actor }}';
          const eventName = '${{ github.event_name }}';
          
          let message = 'ğŸ›¡ï¸ *StellarSpeak Site Guardian Report*\\n';
          message += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n\\n';
          
          message += 'ğŸ“Š *Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­Øµ:*\\n';
          message += 'â€¢ Ø§Ù„Ø­Ø§Ù„Ø©: ' + status + '\\n';
          message += 'â€¢ Ù†Ø¬Ø­: âœ… ' + passed + ' Ø§Ø®ØªØ¨Ø§Ø±\\n';
          message += 'â€¢ ÙØ´Ù„: âŒ ' + failed + ' Ø§Ø®ØªØ¨Ø§Ø±\\n';
          message += 'â€¢ ØªÙ… ØªØ®Ø·ÙŠÙ‡: â­ï¸ ' + skipped + ' Ø§Ø®ØªØ¨Ø§Ø±\\n';
          message += 'â€¢ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ğŸ“ˆ ' + total + ' Ø§Ø®ØªØ¨Ø§Ø±\\n';
          message += 'â€¢ Ù…Ø¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ°: â±ï¸ ' + duration + ' Ø«Ø§Ù†ÙŠØ©\\n\\n';
          
          message += 'ğŸ” *Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ­Øµ:*\\n';
          message += 'â€¢ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ğŸŒ [stellarspeak.online](https://www.stellarspeak.online)\\n';
          message += 'â€¢ Ø§Ù„ÙˆÙ‚Øª: ğŸ• ' + timestamp + '\\n';
          message += 'â€¢ Ù†ÙˆØ¹ Ø§Ù„ØªØ´ØºÙŠÙ„: ğŸ”„ ' + (eventName === 'schedule' ? 'ØªÙ„Ù‚Ø§Ø¦ÙŠ (ÙƒÙ„ 12 Ø³Ø§Ø¹Ø©)' : 'ÙŠØ¯ÙˆÙŠ') + '\\n';
          message += 'â€¢ Ø±Ù‚Ù… Ø§Ù„ØªØ´ØºÙŠÙ„: #' + runNumber + '\\n\\n';
          
          if (failed > 0) {
            message += 'âš ï¸ *ØªØ­Ø°ÙŠØ± - Ù…Ø´Ø§ÙƒÙ„ Ù…ÙƒØªØ´ÙØ©:*\\n';
            message += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n';
            message += 'ğŸ”´ ØªÙ… Ø§ÙƒØªØ´Ø§Ù *' + failed + ' Ù…Ø´ÙƒÙ„Ø©* ØªØ­ØªØ§Ø¬ ÙØ­Øµ ÙÙˆØ±ÙŠ!\\n';
            message += 'ğŸ” ÙŠÙÙ†ØµØ­ Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØµÙ„ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©\\n';
            message += 'âš¡ Ù‚Ø¯ ØªØ¤Ø«Ø± Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø¹Ù„Ù‰ ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†\\n\\n';
          } else if (passed > 0) {
            message += 'âœ… *Ù…Ù…ØªØ§Ø² - Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ!*\\n';
            message += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n';
            message += 'ğŸš€ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª (' + passed + ') Ù†Ø¬Ø­Øª Ø¨Ù„Ø§ Ø£ÙŠ Ù…Ø´Ø§ÙƒÙ„\\n';
            message += 'ğŸ’¯ Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù ØªØ¹Ù…Ù„ Ø¨ÙƒÙØ§Ø¡Ø© Ø¹Ø§Ù„ÙŠØ©\\n';
            message += 'ğŸ¯ Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø£ÙŠ Ø¥Ø¬Ø±Ø§Ø¡ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ\\n\\n';
          } else {
            message += 'âš ï¸ *ØªØ­Ø°ÙŠØ± - Ù„Ù… ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª:*\\n';
            message += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n';
            message += 'ğŸ”§ Ù‚Ø¯ ØªÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ØªÙ‚Ù†ÙŠØ© ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ­Øµ\\n';
            message += 'ğŸ‘¨â€ğŸ’» ÙŠÙÙ†ØµØ­ Ø¨ÙØ­Øµ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª\\n\\n';
          }
          
          message += 'ğŸ“‹ *Ø±ÙˆØ§Ø¨Ø· Ù…ÙÙŠØ¯Ø©:*\\n';
          message += 'â€¢ [Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠ](${{ github.server_url }}/${{ github.repository }}/actions/runs/' + runId + ')\\n';
          message += 'â€¢ [Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ´ØºÙŠÙ„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©](${{ github.server_url }}/${{ github.repository }}/actions)\\n';
          message += 'â€¢ [Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±](https://www.stellarspeak.online)\\n';
          
          fs.writeFileSync('telegram-message.txt', message);
          console.log('status=' + status);
          console.log('passed=' + passed);
          console.log('failed=' + failed);
          console.log('total=' + total);
          
        } catch (error) {
          const errorTime = new Date().toLocaleString('ar-SA', {timeZone: 'Asia/Riyadh'});
          const runId = '${{ github.run_id }}';
          
          const errorMessage = 'ğŸš¨ *Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ù…ÙˆÙ‚Ø¹ StellarSpeak*\\n' +
            'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n\\n' +
            'âŒ *Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:* ØªØ¹Ø°Ø± ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­Øµ\\n' +
            'â° *Ø§Ù„ÙˆÙ‚Øª:* ' + errorTime + '\\n' +
            'ğŸ”§ *Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„:* Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\\n\\n' +
            'ğŸ“‹ *Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:*\\n' +
            'â€¢ ÙØ­Øµ ÙŠØ¯ÙˆÙŠ Ù„Ù„Ù…ÙˆÙ‚Ø¹\\n' +
            'â€¢ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª GitHub Actions\\n' +
            'â€¢ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª\\n\\n' +
            'ğŸ”— *Ø§Ù„ØªÙØ§ØµÙŠÙ„:*\\n' +
            '[Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„ÙƒØ§Ù…Ù„Ø©](${{ github.server_url }}/${{ github.repository }}/actions/runs/' + runId + ')';
          
          fs.writeFileSync('telegram-message.txt', errorMessage);
          console.log('status=ERROR');
        }
        "
      continue-on-error: true
    
    - name: ğŸ” Debug Secrets  # â¬…ï¸ Ø¥Ø¶Ø§ÙØ© Ø®Ø·ÙˆØ© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Secrets
      run: |
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "ğŸ” Checking Telegram Secrets..."
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        
        if [ -n "${{ secrets.TELEGRAM_BOT_TOKEN }}" ]; then
          TOKEN_LENGTH=$(echo -n "${{ secrets.TELEGRAM_BOT_TOKEN }}" | wc -c)
          echo "âœ… TELEGRAM_BOT_TOKEN is set (length: $TOKEN_LENGTH characters)"
        else
          echo "âŒ TELEGRAM_BOT_TOKEN is NOT set - Please add it in repository secrets"
        fi
        
        if [ -n "${{ secrets.TELEGRAM_CHAT_ID }}" ]; then
          echo "âœ… TELEGRAM_CHAT_ID is set: ${{ secrets.TELEGRAM_CHAT_ID }}"
        else
          echo "âŒ TELEGRAM_CHAT_ID is NOT set - Please add it in repository secrets"
        fi
        
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      continue-on-error: true
    
    - name: ğŸ“¤ Send Telegram Notification
      if: always()
      run: |
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "ğŸ“¤ Preparing Telegram notification..."
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        
        # â¬…ï¸ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Secrets Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        if [ -z "${{ secrets.TELEGRAM_BOT_TOKEN }}" ]; then
          echo "âŒ TELEGRAM_BOT_TOKEN is not configured"
          echo "âš ï¸ Skipping Telegram notification"
          exit 0
        fi
        
        if [ -z "${{ secrets.TELEGRAM_CHAT_ID }}" ]; then
          echo "âŒ TELEGRAM_CHAT_ID is not configured"
          echo "âš ï¸ Skipping Telegram notification"
          exit 0
        fi
        
        # â¬…ï¸ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        if [ -f "telegram-message.txt" ]; then
          MESSAGE=$(cat telegram-message.txt)
          echo "âœ… Message loaded from telegram-message.txt"
        else
          TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
          MESSAGE="ğŸ›¡ï¸ *StellarSpeak Site Check Ù…ÙƒØªÙ…Ù„*\\n\\nâ° *Ø§Ù„ÙˆÙ‚Øª:* $TIMESTAMP UTC\\nğŸŒ *Ø§Ù„Ù…ÙˆÙ‚Ø¹:* [stellarspeak.online](https://www.stellarspeak.online)\\nğŸ”„ *Ø§Ù„Ø­Ø§Ù„Ø©:* ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ÙØ­Øµ\\n\\nğŸ“‹ [Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})"
          echo "âš ï¸ Using fallback message"
        fi
        
        # â¬…ï¸ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ø¹ ØªØ³Ø¬ÙŠÙ„ Ù…ÙØµÙ„
        echo "ğŸ“¡ Sending message to Telegram..."
        HTTP_RESPONSE=$(curl -w "\\n%{http_code}" -s -X POST \
          "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
          -H "Content-Type: application/json" \
          -d "{
            \"chat_id\": \"${{ secrets.TELEGRAM_CHAT_ID }}\",
            \"text\": $(echo "$MESSAGE" | jq -Rs .),
            \"parse_mode\": \"Markdown\",
            \"disable_web_page_preview\": true
          }")
        
        HTTP_CODE=$(echo "$HTTP_RESPONSE" | tail -n1)
        RESPONSE_BODY=$(echo "$HTTP_RESPONSE" | head -n-1)
        
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "ğŸ“Š Telegram API Response:"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "HTTP Status Code: $HTTP_CODE"
        echo "Response Body: $RESPONSE_BODY"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        
        if [ "$HTTP_CODE" = "200" ]; then
          echo "âœ… Ø±Ø³Ø§Ù„Ø© Telegram Ø£ÙØ±Ø³Ù„Øª Ø¨Ù†Ø¬Ø§Ø­!"
        else
          echo "âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Telegram"
          echo "ğŸ” Please check:"
          echo "  1. Bot token is valid"
          echo "  2. Chat ID is correct"
          echo "  3. Bot has been started with /start command"
          echo "  4. Bot has permission to send messages"
        fi
      continue-on-error: true
    
    - name: ğŸ“Š Upload Test Reports
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: site-guardian-report-${{ github.run_number }}
        path: |
          test-results/
          playwright-report/
          test-results.json
          telegram-message.txt
        retention-days: 30

    # Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„ Ø¹Ù†Ø¯ Ø§Ù„ÙØ´Ù„ Ø§Ù„Ø­Ø±Ø¬
    - name: ğŸš¨ Send Detailed Alert on Critical Failure
      if: failure()
      run: |
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "ğŸš¨ Critical failure detected - sending alert..."
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        
        # â¬…ï¸ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Secrets
        if [ -z "${{ secrets.TELEGRAM_BOT_TOKEN }}" ] || [ -z "${{ secrets.TELEGRAM_CHAT_ID }}" ]; then
          echo "âŒ Telegram not configured - skipping alert"
          exit 0
        fi
        
        TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
        ALERT_MESSAGE="ğŸš¨ *ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø§Ø¬Ù„ - Ù…Ø´ÙƒÙ„Ø© Ø­Ø±Ø¬Ø© ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹*\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n\\nâŒ *Ø­Ø§Ù„Ø© Ø§Ù„ÙØ­Øµ:* ÙØ´Ù„ ÙƒØ§Ù…Ù„ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ÙØ­Øµ\\nğŸ” *Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:* Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ Ø­Ø±Ø¬\\nâ° *ÙˆÙ‚Øª Ø§Ù„Ø§ÙƒØªØ´Ø§Ù:* $TIMESTAMP UTC\\nğŸŒ *Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…ØªØ£Ø«Ø±:* [stellarspeak.online](https://www.stellarspeak.online)\\n\\nğŸ“‹ *Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:*\\nâ€¢ ğŸ”Œ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ Ø§Ù„Ø®Ø§Ø¯Ù…\\nâ€¢ âš™ï¸ Ø®Ø·Ø£ ÙÙŠ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ÙØ­Øµ Ø£Ùˆ Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª\\nâ€¢ ğŸŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­ Ø£Ùˆ Ø¨Ø·ÙŠØ¡ Ø¬Ø¯Ø§Ù‹\\nâ€¢ ğŸ” Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©\\nâ€¢ ğŸ’¾ Ù†ÙØ§Ø¯ Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø®Ø§Ø¯Ù…\\n\\nğŸ”§ *Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙˆØ±Ø§Ù‹:*\\n1ï¸âƒ£ ÙØ­Øµ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­\\n2ï¸âƒ£ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø®Ø§Ø¯Ù… (Server Logs)\\n3ï¸âƒ£ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ø³ØªØ¶Ø§ÙØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹\\n4ï¸âƒ£ ÙØ­Øµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub Actions\\n5ï¸âƒ£ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª ÙˆØ§Ù„ØªØ¨Ø¹ÙŠØ§Øª\\n\\nğŸ“Š *Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:*\\nâ€¢ Ø±Ù‚Ù… Ø§Ù„ØªØ´ØºÙŠÙ„: #${{ github.run_number }}\\nâ€¢ Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¯Ø«: ${{ github.event_name }}\\nâ€¢ Ø§Ù„ÙØ±Ø¹: ${{ github.ref_name }}\\n\\nğŸ”— *Ø±ÙˆØ§Ø¨Ø· Ù…Ù‡Ù…Ø©:*\\nâ€¢ [Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„ÙƒØ§Ù…Ù„Ø©](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})\\nâ€¢ [Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ´ØºÙŠÙ„Ø§Øª](${{ github.server_url }}/${{ github.repository }}/actions)\\nâ€¢ [Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±](https://www.stellarspeak.online)\\n\\nâš ï¸ *Ù…Ù„Ø§Ø­Ø¸Ø©:* ÙŠÙÙ†ØµØ­ Ø¨Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ† Ù„ØªØ¬Ù†Ø¨ ØªØ£Ø«ÙŠØ±Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"

        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
          -H "Content-Type: application/json" \
          -d "{
            \"chat_id\": \"${{ secrets.TELEGRAM_CHAT_ID }}\",
            \"text\": $(echo "$ALERT_MESSAGE" | jq -Rs .),
            \"parse_mode\": \"Markdown\",
            \"disable_web_page_preview\": false
          }" && echo "âœ… Critical alert sent" || echo "âš ï¸ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¹Ø§Ø¬Ù„"
